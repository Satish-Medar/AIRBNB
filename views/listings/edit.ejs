<% layout("/layouts/boilerplate") %>

<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">

        <h1 class="mb-4 fw-bold text-center">Edit Listing</h1>

        <form 
          method="POST" 
          action="/listings/<%= listing._id %>?_method=PUT" 
          enctype="multipart/form-data" 
          class="needs-validation" 
          novalidate
        >
          <input type="hidden" name="_method" value="PUT" />

          <!-- TITLE -->
          <div class="form-floating mb-4">
            <input 
              type="text" 
              class="form-control" 
              id="title" 
              name="listing[title]"
              value="<%= listing.title %>"
              required
            />
            <label for="title">Title</label>
            <div class="invalid-feedback">Please enter a valid title.</div>
          </div>

          <!-- DESCRIPTION -->
          <div class="form-floating mb-4">
            <textarea 
              class="form-control" 
              id="desc" 
              name="listing[desc]" 
              style="height: 120px"
              required
            ><%= listing.desc %></textarea>
            <label for="desc">Description</label>
            <div class="invalid-feedback">Please enter at least 10 characters.</div>
          </div>

          <!-- IMAGE UPLOAD -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Update Image (Optional)</label>
            <input 
              type="file" 
              class="form-control" 
              id="image" 
              name="listing[image]" 
              accept="image/*"
            />
            <div class="form-text">Leave empty to keep existing image.</div>

            <% if (listing.image && listing.image.url) { %>
              <div class="mt-3">
                <p class="small fw-semibold">Current Image:</p>
                <img 
                  src="<%= listing.image.url %>" 
                  class="img-fluid rounded shadow-sm" 
                  style="max-height: 200px;"
                />
              </div>
            <% } %>
          </div>

          <!-- PRICE -->
          <div class="form-floating mb-4">
            <input 
              type="number" 
              class="form-control" 
              id="price" 
              name="listing[price]" 
              value="<%= listing.price %>"
              required
            />
            <label for="price">Price</label>
            <div class="invalid-feedback">Please enter a valid price.</div>
          </div>

          <div class="row">
            <!-- LOCATION -->
            <div class="col-md-6 mb-4">
              <div class="form-floating">
                <input 
                  type="text" 
                  class="form-control" 
                  id="location" 
                  name="listing[location]" 
                  value="<%= listing.location %>"
                  required
                />
                <label for="location">Location</label>
                <div class="invalid-feedback">Please enter a location.</div>
              </div>
            </div>

            <!-- COUNTRY -->
            <div class="col-md-6 mb-4">
              <div class="form-floating">
                <input 
                  type="text" 
                  class="form-control" 
                  id="country" 
                  name="listing[country]" 
                  value="<%= listing.country %>"
                  required
                />
                <label for="country">Country</label>
                <div class="invalid-feedback">Please enter a country.</div>
              </div>
            </div>
          </div>

          <!-- CATEGORY -->
          <div class="mb-4">
            <label for="category" class="form-label fw-semibold">Category</label>
            <select 
              id="category" 
              class="form-select" 
              name="listing[category]" 
              required
            >
              <% const options = ["Rooms","Iconic Cities","Mountains","Castles","Arctic","Camping","Farms","Pools","Domes","Boats","Trending"]; %>
              <% options.forEach(option => { %>
                <option value="<%= option %>" <%= listing.category === option ? "selected" : "" %>>
                  <%= option %>
                </option>
              <% }) %>
            </select>
          </div>

          <!-- BUTTONS -->
          <div class="row g-3">
            <div class="col-md-6">
              <button 
                type="button" 
                class="btn btn-outline-secondary w-100" 
                onclick="window.location='/listings/<%= listing._id %>'"
              >
                Cancel
              </button>
            </div>
            <div class="col-md-6">
              <button 
                type="submit" 
                class="btn btn-success w-100"
              >
                Save Changes
              </button>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
</body>
